from gui import display
from ai import *
import numpy as np
from Sim import Interface


def act_interpreter(act):
    # act : [0] = cube num , [1] = axis , [2] = degree
    axis = 'x'  # 'x'
    if act[1] == 1:
        axis = 'y'
    elif act[1] == 2:
        axis = 'z'

    degree = 90  # 90
    if act[2] == 2:
        degree = 180
    elif act[2] == -1:
        degree = -90
    return act[0], axis, degree


if __name__ == "__main__":
    test = [
        {"coordinates": [[1, 1, 1], [1, 1, 0], [1, 0, 0], [0, 0, 0], [0, 0, 1], [0, 1, 1], [0, 1, 2], [-1, 1, 2],
                         [-1, 0, 2], [0, 0, 2], [0, -1, 2], [0, -1, 1], [0, -1, 0], [-1, -1, 0], [-2, -1, 0],
                         [-2, -1, 1], [-1, -1, 1], [-1, -1, 2], [-2, -1, 2], [-2, 0, 2], [-2, 0, 1], [-1, 0, 1],
                         [-1, 0, 0], [-2, 0, 0], [-2, 1, 0], [-2, 1, 1], [-2, 1, 2]],
         "stick_together": [[0, 1], [1, 2], [2, 3], [5, 6], [6, 7], [9, 10], [10, 11], [11, 12], [17, 18], [20, 21],
                            [25, 26]]},
        {"coordinates": [[0, 0, -1], [0, 0, 0], [-1, 0, 0], [-1, 0, -1], [-2, 0, -1], [-2, -1, -1], [-2, -1, 0],
                         [-2, 0, 0], [-2, 0, 1], [-2, -1, 1], [-2, -2, 1], [-1, -2, 1], [-1, -2, 0], [-2, -2, 0],
                         [-2, -2, -1], [-1, -2, -1], [-1, -1, -1], [0, -1, -1], [0, -2, -1], [0, -2, 0], [0, -2, 1],
                         [0, -1, 1], [-1, -1, 1], [-1, -1, 2], [0, -1, 2], [0, 0, 2], [0, 0, 1]],
         "stick_together": [[1, 2], [4, 5], [9, 10], [11, 12], [13, 14], [15, 16], [17, 18], [18, 19]]},
        {"coordinates": [[2, -1, -2], [1, -1, -2], [1, 0, -2], [2, 0, -2], [2, 0, -1], [2, 0, 0], [2, -1, 0],
                         [2, -1, -1], [1, -1, -1], [0, -1, -1], [0, -1, 0], [1, -1, 0], [1, 0, 0], [1, 0, -1],
                         [0, 0, -1], [0, 0, 0], [0, 1, 0], [-1, 1, 0], [-1, 1, -1], [0, 1, -1], [0, 1, -2], [-1, 1, -2],
                         [-2, 1, -2], [-2, 1, -1], [-2, 1, 0], [-3, 1, 0], [-4, 1, 0]],
         "stick_together": [[2, 3], [7, 8], [8, 9], [11, 12], [17, 18], [23, 24], [24, 25]]},
        {"coordinates": [[2, 2, -2], [2, 2, -1], [2, 1, -1], [1, 1, -1], [1, 0, -1], [2, 0, -1], [2, 0, 0], [1, 0, 0],
                         [0, 0, 0], [0, 0, 1], [0, 0, 2], [1, 0, 2], [2, 0, 2], [2, -1, 2], [1, -1, 2], [0, -1, 2],
                         [0, -1, 3], [1, -1, 3], [1, -2, 3], [0, -2, 3], [0, -3, 3], [1, -3, 3], [2, -3, 3], [2, -3, 2],
                         [1, -3, 2], [0, -3, 2], [0, -2, 2]],
         "stick_together": [[1, 2], [5, 6], [8, 9], [10, 11], [12, 13], [17, 18], [20, 21], [21, 22], [24, 25]]},
        {"coordinates": [[0, -2, 0], [0, -1, 0], [0, 0, 0], [0, 0, -1], [0, 0, -2], [0, -1, -2], [0, -1, -1],
                         [0, -2, -1], [0, -2, -2], [-1, -2, -2], [-1, -1, -2], [-1, 0, -2], [-1, 0, -1], [-2, 0, -1],
                         [-2, -1, -1], [-2, -1, 0], [-2, 0, 0], [-1, 0, 0], [-1, -1, 0], [-1, -1, -1], [-1, -2, -1],
                         [-1, -2, 0], [-2, -2, 0], [-2, -2, -1], [-2, -2, -2], [-2, -3, -2], [-2, -4, -2]],
         "stick_together": [[1, 2], [2, 3], [11, 12], [17, 18], [19, 20], [22, 23]]},
        {"coordinates": [[2, 2, -2], [2, 1, -2], [2, 1, -1], [2, 0, -1], [1, 0, -1], [1, 1, -1], [1, 2, -1], [2, 2, -1],
                         [2, 2, 0], [1, 2, 0], [0, 2, 0], [0, 2, -1], [0, 1, -1], [0, 1, 0], [1, 1, 0], [2, 1, 0],
                         [2, 0, 0], [1, 0, 0], [0, 0, 0], [0, 0, -1], [0, 0, -2], [0, -1, -2], [0, -2, -2], [0, -2, -3],
                         [0, -1, -3], [0, 0, -3], [0, 0, -4]],
         "stick_together": [[0, 1], [2, 3], [3, 4], [7, 8], [8, 9], [12, 13], [16, 17], [18, 19], [20, 21], [25, 26]]},
        {"coordinates": [[0, 0, -1], [0, 0, -2], [0, -1, -2], [0, -1, -1], [0, -1, 0], [0, 0, 0], [0, 0, 1], [1, 0, 1],
                         [2, 0, 1], [2, -1, 1], [2, -1, 2], [1, -1, 2], [1, 0, 2], [2, 0, 2], [2, 1, 2], [2, 1, 1],
                         [2, 1, 0], [1, 1, 0], [0, 1, 0], [0, 1, 1], [1, 1, 1], [1, 1, 2], [0, 1, 2], [0, 0, 2],
                         [0, -1, 2], [0, -1, 1], [1, -1, 1]],
         "stick_together": [[1, 2], [6, 7], [7, 8], [9, 10], [11, 12], [13, 14], [14, 15], [15, 16], [17, 18], [21, 22],
                            [24, 25]]},
        {"coordinates": [[2, 2, -2], [3, 2, -2], [3, 2, -1], [3, 2, 0], [4, 2, 0], [4, 2, -1], [4, 1, -1], [3, 1, -1],
                         [3, 0, -1], [2, 0, -1], [2, 1, -1], [2, 2, -1], [2, 2, 0], [1, 2, 0], [0, 2, 0], [0, 1, 0],
                         [1, 1, 0], [1, 0, 0], [0, 0, 0], [0, 0, -1], [0, 0, -2], [0, -1, -2], [0, -2, -2],
                         [-1, -2, -2], [-1, -1, -2], [-1, 0, -2], [-2, 0, -2]],
         "stick_together": [[1, 2], [6, 7], [10, 11], [18, 19], [23, 24], [25, 26]]},
        {"coordinates": [[-1, -3, 0], [-1, -3, 1], [-1, -3, 2], [0, -3, 2], [0, -2, 2], [1, -2, 2], [1, -2, 1],
                         [1, -2, 0], [1, -1, 0], [1, -1, 1], [1, -1, 2], [0, -1, 2], [-1, -1, 2], [-1, -2, 2],
                         [-1, -2, 1], [-1, -1, 1], [0, -1, 1], [0, -1, 0], [0, 0, 0], [-1, 0, 0], [-1, 1, 0],
                         [-1, 1, -1], [-2, 1, -1], [-2, 1, 0], [-2, 2, 0], [-2, 2, -1], [-2, 2, -2]],
         "stick_together": [[2, 3], [3, 4], [4, 5], [6, 7], [7, 8], [9, 10], [13, 14], [14, 15], [15, 16], [19, 20],
                            [20, 21], [21, 22], [22, 23]]},
        {"coordinates": [[1, 2, 0], [2, 2, 0], [2, 1, 0], [2, 1, 1], [2, 0, 1], [1, 0, 1], [0, 0, 1], [0, 0, 0],
                         [0, -1, 0], [0, -1, -1], [0, 0, -1], [-1, 0, -1], [-2, 0, -1], [-2, -1, -1], [-1, -1, -1],
                         [-1, -1, -2], [-1, 0, -2], [-2, 0, -2], [-2, 0, -3], [-1, 0, -3], [0, 0, -3], [0, -1, -3],
                         [0, -2, -3], [0, -2, -2], [-1, -2, -2], [-1, -2, -3], [-2, -2, -3]],
         "stick_together": [[1, 2], [2, 3], [8, 9], [9, 10], [12, 13], [14, 15], [15, 16], [17, 18], [18, 19]]},
        {"coordinates": [[0, 1, 2], [-1, 1, 2], [-2, 1, 2], [-2, 1, 1], [-2, 1, 0], [-2, 0, 0], [-2, 0, 1], [-1, 0, 1],
                         [-1, 0, 2], [-2, 0, 2], [-2, -1, 2], [-1, -1, 2], [-1, -1, 1], [-2, -1, 1], [-2, -1, 0],
                         [-1, -1, 0], [0, -1, 0], [0, -1, 1], [0, -1, 2], [0, 0, 2], [0, 0, 1], [0, 0, 0], [0, 1, 0],
                         [1, 1, 0], [1, 0, 0], [1, 0, 1], [1, 1, 1]],
         "stick_together": [[1, 2], [8, 9], [9, 10], [14, 15], [20, 21]]},
        {"coordinates": [[-1, 1, -1], [0, 1, -1], [0, 0, -1], [0, 0, 0], [0, -1, 0], [-1, -1, 0], [-1, -1, -1],
                         [0, -1, -1], [1, -1, -1], [1, -1, 0], [1, -1, 1], [2, -1, 1], [3, -1, 1], [3, -2, 1],
                         [2, -2, 1], [1, -2, 1], [1, -3, 1], [2, -3, 1], [2, -3, 0], [1, -3, 0], [1, -3, -1],
                         [2, -3, -1], [3, -3, -1], [3, -2, -1], [2, -2, -1], [1, -2, -1], [1, -2, 0]],
         "stick_together": [[0, 1], [1, 2], [5, 6], [7, 8], [10, 11], [13, 14], [14, 15], [16, 17], [17, 18], [18, 19],
                            [19, 20], [21, 22], [23, 24], [24, 25], [25, 26]]},
    ]
    for i, problem in enumerate(test):
        coo = np.asarray(problem["coordinates"])
        sticky_cubes = problem["stick_together"]
        # display(coo)
        game = Simulator(coo, sticky_cubes)
        interface = Interface(game)
        agent = Agent()
        action_count = 0
        while not (interface.goal_test()):
            per = interface.perceive()
            per = json.loads(per)
            y, z = per['coordinates'], per['stick_together']
            for u in z:
                for j in range(0, len(u)):
                    u[j] += 1
            perc = "{\"coordinates\": " + \
                   f"{y}, \"stick_together\":" \
                   f" {z}" \
                   + "}"

            action = agent.act(perc)
            action = act_interpreter(action)
            print("attempting in ", i, action)
            interface.evolve(action)
            display(game.coordinates)
            action_count += 1
        print("And finally , It's a CUBE !!")
else:
    print("What's this??")
